module.exports=function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=6)}([function(e,t){e.exports=require("fs")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(5),s=i(0),n=i(3);class a{constructor(e){this.path=e,this.name=r.basename(e),this.noSuffixName=this.GetNoSuffixName(this.name),this.suffix=r.extname(e),this.dir=r.dirname(e)}static fromArray(e){return new a(e.join(a.sep))}static ToUnixPath(e){return r.normalize(e).replace(/\\{1,}/g,"/")}static ToUri(e){return"file://"+this.ToNoProtocolUri(e)}static ToNoProtocolUri(e){return"/"+encodeURIComponent(e.replace(/\\/g,"/"))}static ToLocalPath(e){const t=a.ToUnixPath(e);return"\\"===a.sep?t.replace(/\//g,a.sep):t}static _match(e,t,i){let r=!1;for(let t of i)if(t.test(e)){r=!0;break}return t&&(r=!r),r}static _filter(e,t,i,r){const s=[];return i?e.forEach(e=>{e.IsFile()&&this._match(e.name,t,i)&&s.push(e)}):e.forEach(e=>{e.IsFile()&&s.push(e)}),r?e.forEach(e=>{e.IsDir()&&this._match(e.name,t,r)&&s.push(e)}):e.forEach(e=>{e.IsDir()&&s.push(e)}),s}static Filter(e,t,i){return this._filter(e,!1,t,i)}static NotMatchFilter(e,t,i){return this._filter(e,!0,t,i)}GetNoSuffixName(e){const t=this.name.split(".");return t.length>1?(t.pop(),t.join(".")):e}_CopyRetainDir(e,t){const i=e.ToRelativePath(t.dir);if(i){const e=a.fromArray([this.path,i.replace(/\//g,a.sep)]);e.IsDir()||this.CreateDir(!0),s.copyFileSync(t.path,e.path+a.sep+t.name)}}ToRelativePath(e,t=!0){if(!r.isAbsolute(e))return;const i=r.relative(this.path,e);return r.isAbsolute(i)?void 0:t?`.${a.sep}${i}`:i}CreateDir(e=!1){if(!this.IsDir()){if(e){let e,t=this.path.split(r.sep);if(t.length>0){let i=t[0];for(let n=0;n<t.length;)e=new a(i),e.IsDir()||s.mkdirSync(e.path),i+=++n<t.length?r.sep+t[n]:"";return}return}s.mkdirSync(this.path)}}GetList(e,t){let i=[];return s.readdirSync(this.path).forEach(s=>{if("."!==s&&".."!==s){const n=new a(this.path+r.sep+s);if(n.IsDir())if(t){for(let e of t)if(e.test(n.name)){i.push(n);break}}else i.push(n);else if(e){for(let t of e)if(t.test(n.name)){i.push(n);break}}else i.push(n)}}),i}GetAll(e,t){let i,r=[],s=this.GetList(e);for(;s.length>0;)i=s.pop(),i.IsDir()&&(s=s.concat(i.GetList(e))),r.push(i);return a.Filter(r,void 0,t)}CopyRetainDir(e,t){this._CopyRetainDir(e,t)}CopyFile(e){s.copyFileSync(e.path,this.path+a.sep+e.name)}CopyList(e,t,i){e.GetList(t,i).forEach(t=>{t.IsFile()&&this.CopyRetainDir(e,t)})}CopyAll(e,t,i){e.GetAll(t,i).forEach(t=>{t.IsFile()&&this.CopyRetainDir(e,t)})}Read(e){return s.readFileSync(this.path,e||"utf8")}Write(e,t){s.writeFileSync(this.path,e,t)}IsExist(){return s.existsSync(this.path)}IsFile(){return!!s.existsSync(this.path)&&s.lstatSync(this.path).isFile()}IsDir(){return!!s.existsSync(this.path)&&s.lstatSync(this.path).isDirectory()}getHash(e){const t=n.createHash(e||"md5");return t.update(s.readFileSync(this.path)),t.digest("hex")}getSize(){return s.statSync(this.path).size}ToUri(){return"file://"+this.ToNoProtocolUri()}ToNoProtocolUri(){return"/"+encodeURIComponent(this.path.replace(/\\/g,"/"))}}t.File=a,a.sep=r.sep,a.delimiter=r.delimiter,a.EMPTY_FILTER=[]},function(e,t){e.exports=require("vscode")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("path")},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(2),n=i(3),a=i(7),o=i(4),c=i(0),h=i(5),l=i(8),u=i(1),p=i(9),d=i(10),m=i(11),_=i(12),g=i(13);t.activate=function(e){console.log("---- keil-assistant actived ----"),p.ResourceManager.getInstance(e);const t=new b(e),i=e.subscriptions;i.push(s.commands.registerCommand("explorer.open",()=>r(this,void 0,void 0,(function*(){const e=yield s.window.showOpenDialog({openLabel:"Open a keil project",canSelectFolders:!1,canSelectMany:!1,filters:{"keil project xml":["uvproj","uvprojx"]}});try{if(e&&e.length>0){const r=e[0].fsPath;yield t.openProject(r);"Ok"===(yield s.window.showInformationMessage("keil project load done !, switch workspace ?","Ok","Later"))&&(i=new u.File(h.dirname(r)),s.commands.executeCommand("vscode.openFolder",s.Uri.parse(i.ToUri())))}}catch(e){s.window.showErrorMessage("open project failed !, msg: "+e.message)}var i})))),i.push(s.commands.registerCommand("project.close",e=>t.closeProject(e.prjID))),i.push(s.commands.registerCommand("project.build",e=>{var i;return null===(i=t.getTarget(e))||void 0===i?void 0:i.build()})),i.push(s.commands.registerCommand("project.rebuild",e=>{var i;return null===(i=t.getTarget(e))||void 0===i?void 0:i.rebuild()})),i.push(s.commands.registerCommand("project.download",e=>{var i;return null===(i=t.getTarget(e))||void 0===i?void 0:i.download()})),i.push(s.commands.registerCommand("item.copyValue",e=>s.env.clipboard.writeText(e.tooltip||""))),i.push(s.commands.registerCommand("project.switch",e=>t.switchTargetByProject(e))),t.loadWorkspace()},t.deactivate=function(){console.log("---- keil-assistant closed ----")};class f{constructor(e,t,i=!0){this.contextVal="Source",this.prjID=e,this.enable=i,this.file=t,this.label=this.file.name,this.tooltip=t.path;let r="";r=!1===t.IsFile()?"FileWarning_16x":!1===i?"FileExclude_16x":this.getIconBySuffix(t.suffix.toLowerCase()),this.icons={dark:r,light:r}}getIconBySuffix(e){switch(e){case".c":return"CFile_16x";case".h":case".hpp":case".hxx":case".inc":return"CPPHeaderFile_16x";case".cpp":case".c++":case".cxx":case".cc":return"CPP_16x";case".s":case".a51":case".asm":return"AssemblerSourceFile_16x";case".lib":case".a":return"Library_16x";default:return"Text_16x"}}getChildViews(){return this.children}}class v{constructor(e,t,i){this.contextVal="FileGroup",this.label=t,this.prjID=e,this.sources=[],this.tooltip=t;const r=i?"FolderExclude_32x":"Folder_32x";this.icons={light:r,dark:r}}getChildViews(){return this.sources}}class w{constructor(e){this.contextVal="Project",this.icons={light:"ApplicationClass_16x",dark:"ApplicationClass_16x"},this._event=new o.EventEmitter,this.uVsionFileInfo={},this.targetList=[],this.vscodeDir=new u.File(e.dir+u.File.sep+".vscode"),this.vscodeDir.CreateDir();const t=this.vscodeDir.path+u.File.sep+"keil-assistant.log";this.logger=new console.Console(c.createWriteStream(t,{flags:"a+"})),this.uvprjFile=e,this.watcher=new d.FileWatcher(this.uvprjFile),this.prjID=function(e){const t=n.createHash("md5");return t.update(e),t.digest("hex")}(e.path),this.label=e.noSuffixName,this.tooltip=e.path,this.logger.log("[info] Log at : "+m.Time.GetInstance().GetTimeStamp()+"\r\n"),this.watcher.OnChanged=()=>{(void 0===this.prevUpdateTime||this.prevUpdateTime+2e3<Date.now())&&(this.prevUpdateTime=Date.now(),setTimeout(()=>this.onReload(),300))},this.watcher.Watch()}on(e,t){this._event.on(e,t)}onReload(){return r(this,void 0,void 0,(function*(){try{this.targetList.forEach(e=>e.close()),this.targetList=[],yield this.load(),this.notifyUpdateView()}catch(e){e.code&&"EBUSY"===e.code?(this.logger.log(`[Warn] uVision project file '${this.uvprjFile.name}' is locked !, delay 500 ms and retry !`),setTimeout(()=>this.onReload(),500)):s.window.showErrorMessage("reload project failed !, msg: "+e.message)}}))}load(){return r(this,void 0,void 0,(function*(){const e=new a.Parser({explicitArray:!1}),t=yield e.parseStringPromise({toString:()=>this.uvprjFile.Read()}),i=t.Project.Targets.Target;if(this.uVsionFileInfo.schemaVersion=t.Project.SchemaVersion,_.isArray(i))for(const e of i)this.targetList.push(x.getInstance(this,this.uVsionFileInfo,e));else this.targetList.push(x.getInstance(this,this.uVsionFileInfo,i));for(const e of this.targetList)yield e.load(),e.on("dataChanged",()=>this.notifyUpdateView())}))}notifyUpdateView(){this._event.emit("dataChanged")}close(){this.watcher.Close(),this.targetList.forEach(e=>e.close()),this.logger.log("[info] project closed: "+this.label)}toAbsolutePath(e){const t=e.replace(/\//g,u.File.sep);return/^[a-z]:/i.test(t)?h.normalize(t):h.normalize(this.uvprjFile.dir+u.File.sep+t)}getTargetByName(e){const t=this.targetList.findIndex(t=>t.targetName===e);if(-1!==t)return this.targetList[t]}setActiveTarget(e){e!==this.activeTargetName&&(this.activeTargetName=e,this.notifyUpdateView())}getChildViews(){if(this.activeTargetName){const e=this.getTargetByName(this.activeTargetName);if(e)return[e]}if(this.targetList.length>0)return[this.targetList[0]]}getTargets(){return this.targetList}}class x{constructor(e,t,i){this.contextVal="Target",this.icons={light:"Class_16x",dark:"Class_16x"},this._event=new o.EventEmitter,this.project=e,this.targetDOM=i,this.uvInfo=t,this.prjID=e.prjID,this.targetName=i.TargetName,this.label=this.targetName,this.tooltip=this.targetName,this.cppConfigName=this.targetName,this.includes=new Set,this.defines=new Set,this.fGroups=[],this.uv4LogFile=new u.File(this.project.vscodeDir.path+u.File.sep+"uv4.log"),this.uv4LogLockFileWatcher=new d.FileWatcher(new u.File(this.uv4LogFile.path+".lock")),this.uv4LogLockFileWatcher.file.IsFile()||this.uv4LogLockFileWatcher.file.Write(""),this.uv4LogLockFileWatcher.Watch(),this.uv4LogLockFileWatcher.OnChanged=()=>this.updateSourceRefs(),this.uv4LogLockFileWatcher.on("error",()=>{this.uv4LogLockFileWatcher.Close(),this.uv4LogLockFileWatcher.file.IsFile()||this.uv4LogLockFileWatcher.file.Write(""),this.uv4LogLockFileWatcher.Watch()})}on(e,t){this._event.on(e,t)}static getInstance(e,t,i){return".uvproj"===e.uvprjFile.suffix.toLowerCase()?new y(e,t,i):new F(e,t,i)}getDefCppProperties(){return{configurations:[{name:this.cppConfigName,includePath:void 0,defines:void 0,intelliSenseMode:"${default}"}],version:4}}updateCppProperties(){const e=new u.File(this.project.vscodeDir.path+u.File.sep+"c_cpp_properties.json");let t;if(e.IsFile())try{t=JSON.parse(e.Read())}catch(e){this.project.logger.log(e),t=this.getDefCppProperties()}else t=this.getDefCppProperties();const i=t.configurations,r=i.findIndex(e=>e.name===this.cppConfigName);-1===r?i.push({name:this.cppConfigName,includePath:Array.from(this.includes),defines:Array.from(this.defines),intelliSenseMode:"${default}"}):(i[r].includePath=Array.from(this.includes),i[r].defines=Array.from(this.defines)),e.Write(JSON.stringify(t,void 0,4))}load(){return r(this,void 0,void 0,(function*(){const e=this.checkProject(this.targetDOM);if(e)throw e;const t=this.getIncString(this.targetDOM),i=this.getDefineString(this.targetDOM),r=this.getGroups(this.targetDOM),s=this.getSystemIncludes(this.targetDOM);this.includes.clear();let n,a=t.split(";");s&&(a=a.concat(s)),a.forEach(e=>{const t=e.trim();""!==t&&this.includes.add(this.project.toAbsolutePath(t))}),this.defines.clear(),i.split(/,|\s+/).forEach(e=>{""!==e.trim()&&this.defines.add(e)}),this.getSysDefines(this.targetDOM).forEach(e=>{this.defines.add(e)}),this.fGroups=[],n=Array.isArray(r)?r:[r];for(const e of n)if(void 0!==e.Files){let t,i=!1;if(e.GroupOption){const t=e.GroupOption.CommonProperty;t&&"0"===t.IncludeInBuild&&(i=!0)}const r=new v(this.prjID,e.GroupName,i);if(Array.isArray(e.Files)){t=[];for(const i of e.Files)Array.isArray(i.File)?t=t.concat(i.File):void 0!==i.File&&t.push(i.File)}else t=Array.isArray(e.Files.File)?e.Files.File:void 0!==e.Files.File?[e.Files.File]:[];for(const e of t){const t=new u.File(this.project.toAbsolutePath(e.FilePath));let s=i;if(!1===s&&e.FileOption){const t=e.FileOption.CommonProperty;t&&"0"===t.IncludeInBuild&&(s=!0)}const n=new f(this.prjID,t,!s);this.includes.add(t.dir),r.sources.push(n)}this.fGroups.push(r)}this.updateCppProperties(),this.updateSourceRefs()}))}quoteString(e,t='"'){return e.includes(" ")?t+e+t:e}runTask(e,t){const i=p.ResourceManager.getInstance();let r=[];r.push("-o",this.uv4LogFile.path),r=r.concat(t);const n=/cmd.exe$/i.test(s.env.shell),a=n?'"':"'",o=n?'"':"";let c=(n?"":"& ")+this.quoteString(i.getBuilderExe(),a)+" ";if(c+=r.map(e=>this.quoteString(e,a)).join(" "),s.workspace.workspaceFolders&&s.workspace.workspaceFolders.length>0){const t=new s.Task({type:"keil-task"},s.TaskScope.Global,e,"shell");t.execution=new s.ShellExecution(o+c+o),t.isBackground=!1,t.problemMatchers=this.getProblemMatcher(),t.presentationOptions={echo:!1,focus:!1,clear:!0},s.tasks.executeTask(t)}else{const t=s.window.terminals.findIndex(t=>t.name===e);-1!==t&&(s.window.terminals[t].hide(),s.window.terminals[t].dispose());const i=s.window.createTerminal(e);i.show(),i.sendText(c)}}build(){this.runTask("build",this.getBuildCommand())}rebuild(){this.runTask("rebuild",this.getRebuildCommand())}download(){this.runTask("download",this.getDownloadCommand())}updateSourceRefs(){const e=this.getOutputFolder(this.targetDOM);if(e){const t=this.project.toAbsolutePath(e);this.fGroups.forEach(e=>{e.sources.forEach(e=>{if(e.enable){const i=u.File.fromArray([t,e.file.noSuffixName+".d"]);if(i.IsFile()){const t=this.parseRefLines(this.targetDOM,i.Read().split(/\r\n|\n/)).map(e=>this.project.toAbsolutePath(e));e.children=t.map(t=>new f(e.prjID,new u.File(t)))}}})}),this._event.emit("dataChanged")}}close(){this.uv4LogLockFileWatcher.Close()}getChildViews(){return this.fGroups}}class y extends x{checkProject(e){if(void 0===e.TargetOption.Target51||void 0===e.TargetOption.Target51.C51)return new Error("This uVision project is not a C51 project, but have a 'uvproj' suffix !")}parseRefLines(e,t){return[]}getOutputFolder(e){}getSysDefines(e){return["__C51__","__VSCODE_C51__","reentrant=","compact=","small=","large=","data=","idata=","pdata=","bdata=","xdata=","code=","bit=char","sbit=char","sfr=char","sfr16=int","sfr32=int","interrupt=","using=","_at_=","_priority_=","_task_="]}getSystemIncludes(e){const t=new u.File(p.ResourceManager.getInstance().getC51UV4Path());if(t.IsFile())return[h.dirname(t.dir)+u.File.sep+"C51"+u.File.sep+"INC"]}getIncString(e){return e.TargetOption.Target51.C51.VariousControls.IncludePath}getDefineString(e){return e.TargetOption.Target51.C51.VariousControls.Define}getGroups(e){return e.Groups.Group||[]}getProblemMatcher(){return["$c51"]}getBuildCommand(){return["--uv4Path",p.ResourceManager.getInstance().getC51UV4Path(),"--prjPath",this.project.uvprjFile.path,"--targetName",this.targetName,"-c","${uv4Path} -b ${prjPath} -j0 -t ${targetName}"]}getRebuildCommand(){return["--uv4Path",p.ResourceManager.getInstance().getC51UV4Path(),"--prjPath",this.project.uvprjFile.path,"--targetName",this.targetName,"-c","${uv4Path} -r ${prjPath} -j0 -t ${targetName}"]}getDownloadCommand(){return["--uv4Path",p.ResourceManager.getInstance().getC51UV4Path(),"--prjPath",this.project.uvprjFile.path,"--targetName",this.targetName,"-c","${uv4Path} -f ${prjPath} -j0 -t ${targetName}"]}}class I{constructor(){this.regMatchers={normal_macro:/^#define (\w+) (.*)$/,func_macro:/^#define (\w+\([^\)]*\)) (.*)$/}}toExpression(e){let t=this.regMatchers.normal_macro.exec(e);return t&&t.length>2?`${t[1]}=${t[2]}`:(t=this.regMatchers.func_macro.exec(e),t&&t.length>2?t[1]+"=":void 0)}}class F extends x{constructor(e,t,i){super(e,t,i),F.initArmclangMacros()}checkProject(){}getOutputFolder(e){try{return e.TargetOption.TargetCommonOption.OutputDirectory}catch(e){return}}gnu_parseRefLines(e){const t=new Set;for(let i=0;i<e.length;i++){let r=e[i],s=("\\"===r[r.length-1]?r.substring(0,r.length-1):r).trim().split(/(?<![\\:]) /);if(0===i)for(let e=1;e<s.length;e++)t.add(s[e].trim().replace(/\\ /g," "));else s.forEach(e=>{t.add(e.trim().replace(/\\ /g," "))})}return Array.from(t)}ac5_parseRefLines(e,t=1){const i=new Set;for(let r=t;r<e.length;r++){let t=e[r].indexOf(": ");if(t>0){const s=e[r].substring(t+1).trim();i.add(s)}}return Array.from(i)}parseRefLines(e,t){return"1"===e.uAC6?this.gnu_parseRefLines(t):this.ac5_parseRefLines(t)}static initArmclangMacros(){if(void 0===F.armclangBuildinMacros){const e=h.dirname(h.dirname(p.ResourceManager.getInstance().getArmUV4Path()))+u.File.sep+"ARM"+u.File.sep+"ARMCLANG"+u.File.sep+"bin"+u.File.sep+"armclang.exe";F.armclangBuildinMacros=F.getArmClangMacroList(e)}}getSysDefines(e){return"1"===e.uAC6?F.armclangMacros.concat(F.armclangBuildinMacros||[]):F.armccMacros}static getArmClangMacroList(e){try{const t=g.CmdLineHandler.quoteString(e,'"')+" "+["--target=arm-arm-none-eabi","-E","-dM","-","<nul"].join(" "),i=l.execSync(t).toString().split(/\r\n|\n/),r=[],s=new I;return i.filter(e=>""!==e.trim()).forEach(e=>{const t=s.toExpression(e);t&&r.push(t)}),r}catch(e){return["__GNUC__=4","__GNUC_MINOR__=2","__GNUC_PATCHLEVEL__=1"]}}getSystemIncludes(e){const t=new u.File(p.ResourceManager.getInstance().getArmUV4Path());if(t.IsFile()){const i="1"===e.uAC6?"ARMCLANG":"ARMCC",r=new u.File(`${h.dirname(t.dir)}${u.File.sep}ARM${u.File.sep}${i}${u.File.sep}include`);return r.IsDir()?[r.path].concat(r.GetList(u.File.EMPTY_FILTER).map(e=>e.path)):[r.path]}}getIncString(e){return e.TargetOption.TargetArmAds.Cads.VariousControls.IncludePath}getDefineString(e){return e.TargetOption.TargetArmAds.Cads.VariousControls.Define}getGroups(e){return e.Groups.Group||[]}getProblemMatcher(){return["$armcc","$gcc"]}getBuildCommand(){return["--uv4Path",p.ResourceManager.getInstance().getArmUV4Path(),"--prjPath",this.project.uvprjFile.path,"--targetName",this.targetName,"-c","${uv4Path} -b ${prjPath} -j0 -t ${targetName}"]}getRebuildCommand(){return["--uv4Path",p.ResourceManager.getInstance().getArmUV4Path(),"--prjPath",this.project.uvprjFile.path,"--targetName",this.targetName,"-c","${uv4Path} -r ${prjPath} -j0 -t ${targetName}"]}getDownloadCommand(){return["--uv4Path",p.ResourceManager.getInstance().getArmUV4Path(),"--prjPath",this.project.uvprjFile.path,"--targetName",this.targetName,"-c","${uv4Path} -f ${prjPath} -j0 -t ${targetName}"]}}F.armccMacros=["__CC_ARM","__arm__","__align(x)=","__ALIGNOF__(x)=","__alignof__(x)=","__asm(x)=","__forceinline=","__restrict=","__global_reg(n)=","__inline=","__int64=long long","__INTADDR__(expr)=0","__irq=","__packed=","__pure=","__smc(n)=","__svc(n)=","__svc_indirect(n)=","__svc_indirect_r7(n)=","__value_in_regs=","__weak=","__writeonly=","__declspec(x)=","__attribute__(x)=","__nonnull__(x)=","__register=","__breakpoint(x)=","__cdp(x,y,z)=","__clrex()=","__clz(x)=0U","__current_pc()=0U","__current_sp()=0U","__disable_fiq()=","__disable_irq()=","__dmb(x)=","__dsb(x)=","__enable_fiq()=","__enable_irq()=","__fabs(x)=0.0","__fabsf(x)=0.0f","__force_loads()=","__force_stores()=","__isb(x)=","__ldrex(x)=0U","__ldrexd(x)=0U","__ldrt(x)=0U","__memory_changed()=","__nop()=","__pld(...)=","__pli(...)=","__qadd(x,y)=0","__qdbl(x)=0","__qsub(x,y)=0","__rbit(x)=0U","__rev(x)=0U","__return_address()=0U","__ror(x,y)=0U","__schedule_barrier()=","__semihost(x,y)=0","__sev()=","__sqrt(x)=0.0","__sqrtf(x)=0.0f","__ssat(x,y)=0","__strex(x,y)=0U","__strexd(x,y)=0","__strt(x,y)=","__swp(x,y)=0U","__usat(x,y)=0U","__wfe()=","__wfi()=","__yield()=","__vfp_status(x,y)=0"],F.armclangMacros=["__alignof__(x)=","__asm(x)=","__asm__(x)=","__forceinline=","__restrict=","__volatile__=","__inline=","__inline__=","__declspec(x)=","__attribute__(x)=","__nonnull__(x)=","__unaligned=","__promise(x)=","__irq=","__swi=","__weak=","__register=","__pure=","__value_in_regs=","__breakpoint(x)=","__current_pc()=0U","__current_sp()=0U","__disable_fiq()=","__disable_irq()=","__enable_fiq()=","__enable_irq()=","__force_stores()=","__memory_changed()=","__schedule_barrier()=","__semihost(x,y)=0","__vfp_status(x,y)=0","__builtin_arm_nop()=","__builtin_arm_wfi()=","__builtin_arm_wfe()=","__builtin_arm_sev()=","__builtin_arm_sevl()=","__builtin_arm_yield()=","__builtin_arm_isb(x)=","__builtin_arm_dsb(x)=","__builtin_arm_dmb(x)=","__builtin_bswap32(x)=0U","__builtin_bswap16(x)=0U","__builtin_arm_rbit(x)=0U","__builtin_clz(x)=0U","__builtin_arm_ldrex(x)=0U","__builtin_arm_strex(x,y)=0U","__builtin_arm_clrex()=","__builtin_arm_ssat(x,y)=0U","__builtin_arm_usat(x,y)=0U","__builtin_arm_ldaex(x)=0U","__builtin_arm_stlex(x,y)=0U"];class b{constructor(e){this.ItemClickCommand="Item.Click",this.itemClickInfo=void 0,this.prjList=new Map,this.viewEvent=new s.EventEmitter,this.onDidChangeTreeData=this.viewEvent.event,e.subscriptions.push(s.window.registerTreeDataProvider("project",this)),e.subscriptions.push(s.commands.registerCommand(this.ItemClickCommand,e=>this.onItemClick(e)))}loadWorkspace(){return r(this,void 0,void 0,(function*(){if(s.workspace.workspaceFolders&&s.workspace.workspaceFolders.length>0){const e=s.workspace.workspaceFile&&/^file:/.test(s.workspace.workspaceFile.toString())?h.dirname(s.workspace.workspaceFile.fsPath):s.workspace.workspaceFolders[0].uri.fsPath,t=new u.File(e);if(t.IsDir()){const e=p.ResourceManager.getInstance().getProjectExcludeList(),i=t.GetList([/\.uvproj[x]?$/i],u.File.EMPTY_FILTER).filter(t=>!e.includes(t.name));for(const e of i)try{yield this.openProject(e.path)}catch(t){s.window.showErrorMessage(`open project: '${e.name}' failed !, msg: ${t.message}`)}}}}))}openProject(e){return r(this,void 0,void 0,(function*(){const t=new w(new u.File(e));if(!this.prjList.has(t.prjID))return yield t.load(),t.on("dataChanged",()=>this.updateView()),this.prjList.set(t.prjID,t),this.updateView(),t}))}closeProject(e){return r(this,void 0,void 0,(function*(){const t=this.prjList.get(e);t&&(t.close(),this.prjList.delete(e),this.clearActiveTargetByPrj(t),this.updateView())}))}switchTargetByProject(e){return r(this,void 0,void 0,(function*(){const t=this.prjList.get(e.prjID);if(t){const e=t.getTargets(),i=yield s.window.showQuickPick(e.map(e=>e.targetName),{canPickMany:!1,placeHolder:"please select a target name for keil project"});i&&t.setActiveTarget(i)}}))}clearActiveTargetByPrj(e){this.currentActiveTarget&&this.currentActiveTarget.prjID===e.prjID&&(this.currentActiveTarget.icons={light:"Class_16x",dark:"Class_16x"},this.currentActiveTarget=void 0)}getTarget(e){if(e){const t=this.prjList.get(e.prjID);if(t){const i=t.getTargets(),r=i.findIndex(t=>t.targetName===e.label);if(-1!==r)return i[r]}}else{if(this.currentActiveTarget)return this.currentActiveTarget;s.window.showWarningMessage("Not found any active target !")}}updateView(){this.viewEvent.fire()}onItemClick(e){return r(this,void 0,void 0,(function*(){switch(e.contextVal){case"Source":{const t=e,i=new u.File(h.normalize(t.file.path));if(i.IsFile()){let e=!0;this.itemClickInfo&&this.itemClickInfo.name===i.path&&this.itemClickInfo.time+260>Date.now()&&(e=!1),this.itemClickInfo={name:i.path,time:Date.now()},s.window.showTextDocument(s.Uri.parse(i.ToUri()),{preview:e})}else s.window.showWarningMessage("Not found file: "+t.file.path)}}}))}getTreeItem(e){const t=new s.TreeItem(e.label);return t.contextValue=e.contextVal,t.tooltip=e.tooltip,t.collapsibleState=void 0===e.getChildViews()?s.TreeItemCollapsibleState.None:s.TreeItemCollapsibleState.Collapsed,e instanceof f&&(t.command={title:e.label,command:this.ItemClickCommand,arguments:[e]}),e.icons&&(t.iconPath={light:p.ResourceManager.getInstance().getIconByName(e.icons.light),dark:p.ResourceManager.getInstance().getIconByName(e.icons.dark)}),t}getChildren(e){return void 0===e?Array.from(this.prjList.values()):e.getChildViews()}}},function(e,t){e.exports=require("xml2js")},function(e,t){e.exports=require("child_process")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),s=i(1);let n;const a=[s.File.sep+"bin",s.File.sep+"res",s.File.sep+"res"+s.File.sep+"icons"];class o{constructor(e){this.extensionDir=new s.File(e.extensionPath),this.dirMap=new Map,this.iconMap=new Map,this.init()}static getInstance(e){if(void 0===n){if(!e)throw Error("context can't be undefined");n=new o(e)}return n}init(){for(const e of a){const t=new s.File(this.extensionDir.path+e);t.IsDir()&&this.dirMap.set(t.noSuffixName,t)}const e=this.dirMap.get("icons");if(e)for(const t of e.GetList([/\.svg$/i],s.File.EMPTY_FILTER))this.iconMap.set(t.noSuffixName,t.path)}getAppConfig(){return r.workspace.getConfiguration("KeilAssistant")}getBuilderExe(){var e;return(null===(e=this.dirMap.get("bin"))||void 0===e?void 0:e.path)+s.File.sep+"Uv4Caller.exe"}getC51UV4Path(){return this.getAppConfig().get("C51.Uv4Path")||"null"}getArmUV4Path(){return this.getAppConfig().get("MDK.Uv4Path")||"null"}getProjectExcludeList(){return this.getAppConfig().get("Project.ExcludeList")||[]}getIconByName(e){return this.iconMap.get(e)}}t.ResourceManager=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),s=i(0),n=i(4);t.FileWatcher=class{constructor(e,t=!1){this.file=e,this.recursive=t,this.isDir=this.file.IsDir(),this._event=new n.EventEmitter}on(e,t){return this._event.on(e,t),this}Watch(){return this.isDir&&void 0===this.selfWatcher&&(this.selfWatcher=s.watch(this.file.dir,{recursive:!1},(e,t)=>{"rename"===e&&t===this.file.name&&this.OnRename&&this.OnRename(this.file)}),this.selfWatcher.on("error",e=>{this._event.emit("error",e)})),void 0===this.watcher&&(this.watcher=s.watch(this.file.path,{recursive:this.recursive},(e,t)=>{switch(e){case"rename":this.OnRename&&this.OnRename(this.isDir?r.File.fromArray([this.file.path,t]):this.file);break;case"change":this.OnChanged&&this.OnChanged(this.isDir?r.File.fromArray([this.file.path,t]):this.file)}}),this.watcher.on("error",e=>{this._event.emit("error",e)})),this}Close(){this.selfWatcher&&(this.selfWatcher.close(),this.selfWatcher=void 0),this.watcher&&(this.watcher.close(),this.watcher=void 0)}}},function(e,t,i){"use strict";let r;var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.YEAR=0]="YEAR",e[e.MONTH=1]="MONTH",e[e.DATE=2]="DATE",e[e.HOUR=3]="HOUR",e[e.MINUTE=4]="MINUTE",e[e.SECOND=5]="SECOND",e[e.REGION=6]="REGION"}(s=t.TimeFieldType||(t.TimeFieldType={}));t.TimeData=class{constructor(e){this.time=e}GetTimeInfo(){return this.time}Increase(e,t){if(!Number.isInteger(t))throw new Error("The increase number of time must be integer");switch(e){case s.YEAR:this.time.year+=t;break;case s.MONTH:this.IncreaseMonth(t);break;case s.DATE:this.IncreaseDate(t);break;case s.HOUR:this.IncreaseHour(t);break;case s.MINUTE:this.IncreaseMinute(t);break;case s.SECOND:this.IncreaseSecond(t)}}Compare(e){let t=this.GetTimeInfo();return t.year!==e.year?t.year-e.year:t.month!==e.month?t.month-e.month:t.date!==e.date?t.date-e.date:t.hour!==e.hour?t.hour-e.hour:t.minute!==e.minute?t.minute-e.minute:t.second!==e.second?t.second-e.second:0}IncreaseMonth(e){this.time.month+=e,this.time.month>12?(this.time.year+=parseInt((this.time.month/12).toString()),this.time.month=this.time.month%12):this.time.month<1&&(this.time.year+=parseInt((this.time.month/12).toString())-1,this.time.month=12+this.time.month%12)}IncreaseDate(e){if(e>=0)for(let t=0;t<e;t++)this.AddDate();else for(let t=0;t<-e;t++)this.ReduceDate()}IncreaseHour(e){this.time.hour+=e,this.time.hour>23?(this.IncreaseDate(parseInt((this.time.hour/24).toString())),this.time.hour=this.time.hour%24):this.time.hour<0&&(this.IncreaseDate(parseInt((this.time.hour/24).toString())-1),this.time.hour=23+this.time.hour%24)}IncreaseMinute(e){this.time.minute+=e,this.time.minute>59?(this.IncreaseHour(parseInt((this.time.minute/60).toString())),this.time.minute=this.time.minute%60):this.time.minute<0&&(this.IncreaseHour(parseInt((this.time.minute/60).toString())-1),this.time.minute=59+this.time.minute%60)}IncreaseSecond(e){this.time.second+=e,this.time.second>59?(this.IncreaseMinute(parseInt((this.time.second/60).toString())),this.time.second=this.time.second%60):this.time.second<0&&(this.IncreaseMinute(parseInt((this.time.second/60).toString())-1),this.time.second=59+this.time.second%60)}AddDate(){this.GetDateOfMonth()===this.time.date?(this.time.date=1,this.IncreaseMonth(1)):this.time.date++}ReduceDate(){1===this.time.date?(this.IncreaseMonth(-1),this.time.date=this.GetDateOfMonth()):this.time.date--}GetDateOfYear(){return this.time.year%4==0?366:365}GetDateOfMonth(){switch(this.time.month){case 4:case 6:case 9:case 11:return 30;case 2:return 366===this.GetDateOfYear()?29:28;default:return 31}}};class n{constructor(){this.date=new Date,this.Separater="|"}static GetInstance(){return r||(r=new n,r)}GetTimeStamp(){this.date.setTime(Date.now());let e=this.GetDateString(),t=this.date.toTimeString().split(" ");return e+=this.Separater+t[0]+this.Separater+t[1],e}GetDateString(){return this.date.getFullYear().toString()+"/"+(this.date.getMonth()+1).toString()+"/"+this.date.getDate().toString()}GetTimeInfo(){return this.date.setTime(Date.now()),{year:this.date.getFullYear(),month:this.date.getMonth(),date:this.date.getDate(),hour:this.date.getHours(),minute:this.date.getMinutes(),second:this.date.getSeconds(),region:this.date.toTimeString().split(" ")[1]}}Parse(e){let t=e.split("|"),i=t[0].split("/"),r=t[1].split(":");return{year:Number.parseInt(i[0]),month:Number.parseInt(i[1]),date:Number.parseInt(i[2]),hour:Number.parseInt(r[0]),minute:Number.parseInt(r[1]),second:Number.parseInt(r[2]),region:t[2]}}Stringify(e){return e.year.toString()+"/"+e.month.toString()+"/"+e.date.toString()+"|"+e.hour.toString()+":"+e.minute.toString()+":"+e.second.toString()+"|"+e.region}SetTimeSeparater(e){this.Separater=e}GetTimeSeparater(){return this.Separater}}t.Time=n},function(e,t){e.exports=require("util")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CmdLineHandler=class{constructor(){}static getCommandLine(e,t,i,r=!1){const s=i?"'":'"',n=i?"":'"';return n+(i?"& ":"")+this.quoteString(e,s)+" "+t.map(e=>r?e:this.quoteString(e,s)).join(" ")+n}static DeleteCmdPrefix(e){return e.replace(/^"|"$/g,"")}static quoteString(e,t){return e.includes(" ")&&!e.includes(t)?t+e+t:e}}}]);
//# sourceMappingURL=extension.js.map